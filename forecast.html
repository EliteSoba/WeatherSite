<html>
<head>
	<meta charset="utf-8">
	<title>Test</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link href="css/forecast.css" rel="stylesheet">
</head>
<body>
	<h1>Forecast Search</h1>
	<script src="http://code.jquery.com/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="http://openlayers.org/api/OpenLayers.js"></script>
	<script src="js/jquery-1.11.3.js"></script>
	<div class="container">
		<form role="form">
		<div class="row">
			<div class="col-md-3">
				<label for="street">Street Address<span class="req">*</span></label>
				<input type="text" class="form-control" id="street" placeholder="Enter street address">
				<div id="streeterr" class="error">
				</div>
			</div>
			<div class="col-md-2">
				<label for="city">City<span class="req">*</span></label>
				<input type="text" class="form-control" id="city" placeholder="Enter the city name">
				<div id="cityerr" class="error">
				</div>
			</div>
			<div class="col-md-2">
				<label for="state">State<span class="req">*</span></label>
				<SELECT class="form-control" id="state">
					<OPTION SELECTED VALUE="">Select your state...</OPTION>
					<OPTION VALUE="AK">Alaska</OPTION>
					<OPTION VALUE="AL">Alabama</OPTION>
					<OPTION VALUE="AR">Arkansas</OPTION>
					<OPTION VALUE="AZ">Arizona</OPTION>
					<OPTION VALUE="CA">California</OPTION>
					<OPTION VALUE="CO">Colorado</OPTION>
					<OPTION VALUE="CT">Connecticut</OPTION>
					<OPTION VALUE="DE">Delaware</OPTION>
					<OPTION VALUE="DC">District of Columbia</OPTION>
					<OPTION VALUE="FL">Florida</OPTION>
					<OPTION VALUE="GA">Georgia</OPTION>
					<OPTION VALUE="HI">Hawaii</OPTION>
					<OPTION VALUE="ID">Idaho</OPTION>
					<OPTION VALUE="IL">Illinois</OPTION>
					<OPTION VALUE="IN">Indiana</OPTION>
					<OPTION VALUE="IA">Iowa</OPTION>
					<OPTION VALUE="KS">Kansas</OPTION>
					<OPTION VALUE="KY">Kentucky</OPTION>
					<OPTION VALUE="LA">Louisiana</OPTION>
					<OPTION VALUE="ME">Maine</OPTION>
					<OPTION VALUE="MD">Maryland</OPTION>
					<OPTION VALUE="MA">Massachusetts</OPTION>
					<OPTION VALUE="MI">Michigan</OPTION>
					<OPTION VALUE="MN">Minnesota</OPTION>
					<OPTION VALUE="MS">Mississippi</OPTION>
					<OPTION VALUE="MO">Missouri</OPTION>
					<OPTION VALUE="MT">Montana</OPTION>
					<OPTION VALUE="NE">Nebraska</OPTION>
					<OPTION VALUE="NV">Nevada</OPTION>
					<OPTION VALUE="NH">New Hampshire</OPTION>
					<OPTION VALUE="NJ">New Jersey</OPTION>
					<OPTION VALUE="NM">New Mexico</OPTION>
					<OPTION VALUE="NY">New York</OPTION>
					<OPTION VALUE="NC">North Carolina</OPTION>
					<OPTION VALUE="ND">North Dakota</OPTION>
					<OPTION VALUE="OH">Ohio</OPTION>
					<OPTION VALUE="OK">Oklahoma</OPTION>
					<OPTION VALUE="OR">Oregon</OPTION>
					<OPTION VALUE="PA">Pennsylvania</OPTION>
					<OPTION VALUE="RI">Rhode Island</OPTION>
					<OPTION VALUE="SC">South Carolina</OPTION>
					<OPTION VALUE="SD">South Dakota</OPTION>
					<OPTION VALUE="TN">Tennessee</OPTION>
					<OPTION VALUE="TX">Texas</OPTION>
					<OPTION VALUE="UT">Utah</OPTION>
					<OPTION VALUE="VT">Vermont</OPTION>
					<OPTION VALUE="VA">Virginia</OPTION>
					<OPTION VALUE="WA">Washington</OPTION>
					<OPTION VALUE="WV">West Virginia</OPTION>
					<OPTION VALUE="WI">Wisconsin</OPTION>
					<OPTION VALUE="WY">Wyoming</OPTION>
				</SELECT>
				<div id="stateerr" class="error">
				</div>
			</div>
			<div class="col-md-3">
				<label for="degree">Degree<span class="req">*</span></label><br />
				<label class="radio-inline"><INPUT TYPE="radio" NAME="degree" VALUE="us" CHECKED>Fahrenheit</label>
				<label class="radio-inline"><INPUT TYPE="radio" NAME="degree" VALUE="si">Celsius</label>
			</div>
			<div class="col-md-2" id="buttons">
				<button type="button" id="search" class="btn btn-primary btn-sm">
				<span class="glyphicon glyphicon-search" aria-hidden="true"></span> Search
				</button>
				<button type="reset" id="clear" class="btn btn-default btn-sm">
				<span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> Clear
				</button>
				<div id="forecast">
					Powered by: <img src="imag/forecast_logo.png" height=3.6%>
				</div>
			</div>
		</div>
		</form>
	<hr>
	<div id="responseArea">
		<!-- Nav tabs -->
		<ul class="nav nav-pills" role="tablist">
			<li role="presentation" class="active"><a href="#current" aria-controls="current" role="tab" data-toggle="tab">Right Now</a></li>
			<li role="presentation"><a href="#next" aria-controls="next" role="tab" data-toggle="tab">Next 24 Hours</a></li>
			<li role="presentation"><a href="#week" aria-controls="week" role="tab" data-toggle="tab">Next 7 Days</a></li>
		</ul>
		
		<!-- Tab panes -->
		<div class="tab-content">
			<div role="tabpanel" class="tab-pane fade in active" id="current">
				<div class="col-xs-12 col-md-6">
					<div class="col-xs-12">
						<table class="table table-striped" id="today">
							<tbody>
							<tr>
								<th colspan=2>
									<div class="col-xs-12 col-md-6" id="todayicon">
										<img src="imag/clear.png" height=50%>
									</div>
									<div class="col-xs-12 col-md-6">
										<div id="todayweather">
											Mostly Cloudy in Los Angeles, CA
										</div>
										<div class="col-xs-8 col-xs-offset-2" id="temp">
											<span class="templarge" id="todaytemp">71</span>&deg; <span class="unit">F</span>
										</div>
										<div class="col-xs-8 col-xs-offset-2" id="highlow">
											<span id="low">L: <span id="todaylow">70</span>&deg;</span>
											|
											<span id="high">H: <span id="todayhigh">79</span>&deg;</span>
										</div>
										<div class="col-xs-2">
											<img src="imag/fb_icon.png" height=5%>
										</div>
									</div>
								</th>
							</tr>
							<tr>
								<td>Precipitation</td>
								<td id="todayprecip"><span>aaaa</td>
							</tr>
							<tr>
								<td>Chance of Rain</td>
								<td id="todayrain">bbbb</td>
							</tr>
							<tr>
								<td>Wind Speed</td>
								<td id="todaywind">cccc</td>
							</tr>
							<tr>
								<td>Dew Point</td>
								<td><span id="todaydew">dddd</span>&deg; <span class="unit">F</span></td>
							</tr>
							<tr>
								<td>Humidity</td>
								<td id="todayhumid">eeee</td>
							</tr>
							<tr>
								<td>Visibility</td>
								<td id="todayvis">ffff</td>
							</tr>
							<tr>
								<td>Sunrise</td>
								<td id="todayrise">gggg</td>
							</tr>
							<tr>
								<td>Sunset</td>
								<td id="todayset">hhhh</td>
							</tr>
							</tbody>
						</table>
					</div>
				</div>
				<div class="col-xs-12 col-md-6" id="mapContainer">
					<div id="basicMap">
					</div>
				</div>
			</div>
			<div role="tabpanel" class="tab-pane fade" id="next">
				<div class="col-xs-12">
					<table class="table" id="day">
						<tbody>
							<tr>
								<th>Time</th>
								<th>Summary</th>
								<th>Cloud Cover</th>
								<th>Temp</th>
								<th>View Details</th>
							</tr>
							<tr>
									<td>10:00 PM</td>
									<td><img src="imag/cloud_day.png" height=15%></td>
									<td>0%</td>
									<td>70.28</td>
									<td>
										<a class="btn btn-primary" role="button" data-toggle="collapse" href="#day0" aria-expanded="false" aria-controles="day0">
										<span class="glyphicon glyphicon-plus" aria-hidden="true"></span> 
										</a>
									</td>
							</tr>
							<tr>
								<td colspan=5 class="more">
								<div class="collapse" id="day0">
									<div class="well">
									<table class="more">
										<tbody>
											<tr>
												<th>Wind</th>
												<th>Humidity</th>
												<th>Visibility</th>
												<th>Pressure</th>
											</tr>
											<tr>
												<td>4mph</td>
												<td>83%</td>
												<td>8.37 mi</td>
												<td>1012.6 mb</td>
											</tr>
										</tbody>
									</table>
									</div>
								</div>
								</td>
							</tr>
							<tr>
									<td>11:00 PM</td>
									<td><img src="imag/cloud_day.png" height=15%></td>
									<td>0%</td>
									<td>70.28</td>
									<td>
										<a class="btn btn-primary" role="button" data-toggle="collapse" href="#day1" aria-expanded="false" aria-controles="day1">
										<span class="glyphicon glyphicon-plus" aria-hidden="true"></span> 
										</a>
									</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			<div role="tabpanel" class="tab-pane fade" id="week">
				<div class="col-xs-12">
					<div class="col-xs-12 col-md-1 col-md-offset-2" id="week1">
						<div class="col-xs-12">
							Friday
						</div>
						<div class="col-xs-12">
							Oct 16
						</div>
						<div class="col-xs-12">
							<img src="imag/cloudy.png" height=7%>
						</div>
						<div class="col-xs-12">
							Min Temp
						</div>
						<div class="col-xs-12">
							<span class="templarge">67&deg;</span>
						</div>
						<div class="col-xs-12">
							Max Temp
						</div>
						<div class="col-xs-12">
							<span class="templarge">81&deg;</span>
						</div>
					</div>
					<div class="col-xs-12 col-md-1" id="week2">
						<div class="col-xs-12">
							Saturday
						</div>
						<div class="col-xs-12">
							Oct 17
						</div>
						<div class="col-xs-12">
							<img src="imag/cloudy.png" height=7%>
						</div>
						<div class="col-xs-12">
							Min Temp
						</div>
						<div class="col-xs-12">
							<span class="templarge">66&deg;</span>
						</div>
						<div class="col-xs-12">
							Max Temp
						</div>
						<div class="col-xs-12">
							<span class="templarge">82&deg;</span>
						</div>
					</div>
					<div class="col-xs-12 col-md-1" id="week3">
						<div class="col-xs-12">
							Saturday
						</div>
						<div class="col-xs-12">
							Oct 17
						</div>
						<div class="col-xs-12">
							<img src="imag/cloudy.png" height=7%>
						</div>
						<div class="col-xs-12">
							Min Temp
						</div>
						<div class="col-xs-12">
							<span class="templarge">66&deg;</span>
						</div>
						<div class="col-xs-12">
							Max Temp
						</div>
						<div class="col-xs-12">
							<span class="templarge">82&deg;</span>
						</div>
					</div>
					<div class="col-xs-12 col-md-1" id="week4">
						<div class="col-xs-12">
							Saturday
						</div>
						<div class="col-xs-12">
							Oct 17
						</div>
						<div class="col-xs-12">
							<img src="imag/cloudy.png" height=7%>
						</div>
						<div class="col-xs-12">
							Min Temp
						</div>
						<div class="col-xs-12">
							<span class="templarge">66&deg;</span>
						</div>
						<div class="col-xs-12">
							Max Temp
						</div>
						<div class="col-xs-12">
							<span class="templarge">82&deg;</span>
						</div>
					</div>
					<div class="col-xs-12 col-md-1" id="week5">
						<div class="col-xs-12">
							Saturday
						</div>
						<div class="col-xs-12">
							Oct 17
						</div>
						<div class="col-xs-12">
							<img src="imag/cloudy.png" height=7%>
						</div>
						<div class="col-xs-12">
							Min Temp
						</div>
						<div class="col-xs-12">
							<span class="templarge">66&deg;</span>
						</div>
						<div class="col-xs-12">
							Max Temp
						</div>
						<div class="col-xs-12">
							<span class="templarge">82&deg;</span>
						</div>
					</div>
					<div class="col-xs-12 col-md-1" id="week6">
						<div class="col-xs-12">
							Saturday
						</div>
						<div class="col-xs-12">
							Oct 17
						</div>
						<div class="col-xs-12">
							<img src="imag/cloudy.png" height=7%>
						</div>
						<div class="col-xs-12">
							Min Temp
						</div>
						<div class="col-xs-12">
							<span class="templarge">66&deg;</span>
						</div>
						<div class="col-xs-12">
							Max Temp
						</div>
						<div class="col-xs-12">
							<span class="templarge">82&deg;</span>
						</div>
					</div>
					<div class="col-xs-12 col-md-1" id="week7">
						<div class="col-xs-12">
							Saturday
						</div>
						<div class="col-xs-12">
							Oct 17
						</div>
						<div class="col-xs-12">
							<img src="imag/cloudy.png" height=7%>
						</div>
						<div class="col-xs-12">
							Min Temp
						</div>
						<div class="col-xs-12">
							<span class="templarge">66&deg;</span>
						</div>
						<div class="col-xs-12">
							Max Temp
						</div>
						<div class="col-xs-12">
							<span class="templarge">82&deg;</span>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	</div>
	<script>
	var street = "";
	var city = "";
	var state = "";
	var degree = "";
	var images = {
		"clear-day":				"clear.png",
		"clear-night":			"clear_night.png",
		"rain":					"rain.png",
		"snow":					"snow.png",
		"sleet":					"sleet.png",
		"wind":					"wind.png",
		"fog":					"fog.png",
		"cloudy":					"cloudy.png",
		"partly-cloudy-day":		"cloud_day.png",
		"partly-cloudy-night":	"cloud_night.png"
	};
	console.log(images);
	function getData(street, city, state, degree) {
		$.ajax({
			url: "http://elasticsobanet-env.elasticbeanstalk.com/forecastapi.php",
			data: {
				street: street,
				city: city,
				state: state,
				degree: degree
			},
			type: 'GET',
			success: parseData,
			error: function() {
				$("#responseArea").text("Error reading data");
			}
		});
	}
	
	function parseData(output) {
		var data = jQuery.parseJSON(output);
		console.log(data);
		var test = document.createElement('div');
		test.setAttribute("class", "row");
		test.innerHTML = output;
		
		generateRightNow(data);
		
		//$("#responseArea").append(test);
		$("#responseArea").css("visibility", "visible");
	}
	
	function generateRightNow(data) {
		var currently = data["currently"]
		console.log(currently);
		var today = $("#today");
		console.log(today);
		console.log(images[currently["icon"]]);
		generateRightNowSummary(data);
		
		$("span.unit").text((degree == "us") ? "F" : "C");
	
		var lat = parseFloat(data.latitude);
		var lon = parseFloat(data.longitude);
		generateMap(lat, lon);
	}
	
	function create(type) {
		return document.createElement(type);
	}
	
	function generateRightNowSummary(data) {
		$("#todayicon").text("");
		var img = create("img");
		img.setAttribute("src", "imag/" + images[data["currently"]["icon"]]);
		img.setAttribute("height", "50%");
		$("#todayicon").append(img);
		
		$("#todayweather").text(data["currently"]["summary"] + " in " + city + ", " + state);
		$("#todaytemp").text(parseInt(data["currently"]["temperature"]));
		
		$("#todaylow").text(parseInt(data["daily"]["data"][0]["temperatureMin"]));
		$("#todayhigh").text(parseInt(data["daily"]["data"][0]["temperatureMax"]));
			var rainfall = "";
			var precipitation = parseFloat(data["currently"]["precipIntensity"]);
			if (degree == "us") {
				if (precipitation <= 0) {
					rainfall = "None";
				}
				else if (precipitation <= 0.002) {
					rainfall = "Very Light";
				}
				else if (precipitation <= 0.017) {
					rainfall = "Light";
				}
				else if (precipitation <= 0.1) {
					rainfall = "Moderate";
				}
				else {
					rainfall = "Heavy";
				}
			}
			else {
				if (precipitation <= 0) {
					rainfall = "None";
				}
				else if (precipitation <= 0.0508) {
					rainfall = "Very Light";
				}
				else if (precipitation <= 0.432) {
					rainfall = "Light";
				}
				else if (precipitation <= 2.54) {
					rainfall = "Moderate";
				}
				else {
					rainfall = "Heavy";
				}
			}
			
		$("#todayprecip").text(rainfall);
		
		$("#todayrain").text(parseFloat(data["currently"]["precipProbability"])*100 + "%");
		$("#todaywind").text(parseFloat(data["currently"]["windSpeed"]).toFixed(2));
		$("#todaydew").text(parseFloat(data["currently"]["dewPoint"]).toFixed(2));
		$("#todayhumid").text(parseFloat(data["currently"]["humidity"])*100 + "%");
		$("#todayvis").text(parseFloat(data["currently"]["visibility"]).toFixed(2));
		
		var rise = new Date(parseInt(data["daily"]["data"][0]["sunriseTime"])*1000);
		var hours = String(rise.getHours());
		if (hours.length == 1) {//Either 1 or 2
			hours = "0" + hours;
		}
		var minutes = String(rise.getMinutes());
		if (minutes.length == 1) {//Either 1 or 2
			minutes = "0" + minutes;
		}
		$("#todayrise").text(hours + ":" + minutes);
		
		var set = new Date(parseInt(data["daily"]["data"][0]["sunsetTime"])*1000);
		hours = String(set.getHours());
		if (hours.length == 1) {//Either 1 or 2
			hours = "0" + hours;
		}
		minutes = String(set.getMinutes());
		if (minutes.length == 1) {//Either 1 or 2
			minutes = "0" + minutes;
		}
		$("#todayset").text(hours + ":" + minutes);
	}
	
	function generateMap(lat, lon) {
		var lonlat = new OpenLayers.LonLat(lon, lat).transform(new OpenLayers.Projection("EPSG:4326"), new OpenLayers.Projection("EPSG:900913"));
		
		$("#basicMap").text("");
		var map = new OpenLayers.Map("basicMap");
		var mapnik = new OpenLayers.Layer.OSM();
		var layer_cloud = new OpenLayers.Layer.XYZ(
			"clouds",
			"http://${s}.tile.openweathermap.org/map/clouds/${z}/${x}/${y}.png",
			{
				isBaseLayer: false,
				opacity: 0.7,
				sphericalMercator: true
			}
		);

		var layer_precipitation = new OpenLayers.Layer.XYZ(
			"precipitation",
			"http://${s}.tile.openweathermap.org/map/precipitation/${z}/${x}/${y}.png",
			{
				isBaseLayer: false,
				opacity: 0.7,
				sphericalMercator: true
			}
		);
		map.addLayers([mapnik, layer_precipitation, layer_cloud]);
		map.setCenter(lonlat, 10);
		var ls = new OpenLayers.Control.LayerSwitcher({'ascending':false});
		map.addControl(ls);
	}
	
	$(document).ready(init());
	
	function init() {
		$('#current a').click(function (e) {
			e.preventDefault()
			$(this).tab('show')
		});
		$('#next a').click(function (e) {
			e.preventDefault()
			$(this).tab('show')
		});
		$('#week a').click(function (e) {
			e.preventDefault()
			$(this).tab('show')
		});
		$("#street").focusout(function(){
			var street = $(this).val().trim();
			if (!street) {
				$("#streeterr").text("Please enter the street address");
			}
			else {
				$("#streeterr").text("");
			}
		});
		$("#city").focusout(function(){
			var city = $(this).val().trim();
			if (!city) {
				$("#cityerr").text("Please enter the city");
			}
			else {
				$("#cityerr").text("");
			}
		});
		$("#state").focusout(function(){
			var state = $(this).val().trim();
			if (!state) {
				$("#stateerr").text("Please select a state");
			}
			else {
				$("#stateerr").text("");
			}
		});
		$("#clear").click(function(){
			$("#streeterr").text("");
			$("#cityerr").text("");
			$("#stateerr").text("");
			//DEBUG
			//$("#responseArea").text("");
			$("#responseArea").css("visibility", "hidden");
		});
		$("#search").click(function(){
			street = $("#street").val().trim();
			city =  $("#city").val().trim();
			state =  $("#state").val().trim();
			degree = $("input:radio[name='degree']:checked").val();
			
			if (!street) {
				$("#streeterr").text("Please enter the street address");
			}
			else {
				$("#streeterr").text("");
			}
			if (!city) {
				$("#cityerr").text("Please enter the city");
			}
			else {
				$("#cityerr").text("");
			}
			if (!state) {
				$("#stateerr").text("Please select a state");
			}
			else {
				$("#stateerr").text("");
			}
			//getData("http://elasticsobanet-env.elasticbeanstalk.com/forecastapi.php?street=2633%20Elendale&city=Los%20Angeles&State=CA&degree=us");
			if (street && city && state) {
				getData(street, city, state, degree);
				return true;
			}
			return false;
		});
	}
	</script>
</body>
</html>